#!/bin/bash
# ┌───────────────────────────────────────────────────────┐
# │ Version        : 2026.02.10-01                        │
# │ Author         : Mark Hamilton │ Co-Pilot AI assisted │
# │ Script Purpose : Toolbox Index                        │
# │ Package        : toolbox                              │
# └───────────────────────────────────────────────────────┘
#
# Usage:
#   tool-box [<tool-name>]
#
# Examples:
#   tool-box
#   tool-box diag
#   tool-box update
#
# Description:
#   Lists all available tools across supported languages:
#     - Bash   → /usr/local/bin/bash
#     - Python → /usr/local/bin/python
#     - PHP    → /usr/local/bin/php
#
#   Displays Script Purpose and Version extracted from each tool’s
#   embedded help block.
#
#   If a Bash tool name is provided, its detailed help block is shown.
#   (Python and PHP tools use their own -h or --help flags.)
#
# End Help

TOOL_ROOT="/usr/local/bin"
LANG_DIRS=("bash" "python" "php")

# ────────────────────────────────────────────────────────────────
# No argument → list all tools by language
# ────────────────────────────────────────────────────────────────
if [ -z "$1" ]; then
    echo "Available Tools:"
    echo

    for lang in "${LANG_DIRS[@]}"; do
        DIR="$TOOL_ROOT/$lang"

        [ -d "$DIR" ] || continue

        echo "[$lang]"
        for file in "$DIR"/*; do
            [ -f "$file" ] || continue

            name=$(basename "$file")

            # Extract metadata
            purpose=$(grep -m1 "^#.*Script Purpose" "$file" \
                      | cut -d':' -f2- \
                      | sed 's/^ *//;s/ *$//;s/│$//')

            version=$(grep -m1 "^#.*Version" "$file" \
                      | cut -d':' -f2- \
                      | sed 's/│$//' \
                      | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')

            printf "  %-15s : %-40s (Version: %s)\n" \
                   "$name" "$purpose" "$version"
        done
        echo
    done

    echo "For Bash tool help:   tool-box <tool-name>"
    echo "For Python tools:     <tool-name> -h"
    echo "For PHP tools:        <tool-name> -h"
    exit 0
fi

# ────────────────────────────────────────────────────────────────
# Argument provided → show help for Bash tools only
# ────────────────────────────────────────────────────────────────
target="$TOOL_ROOT/bash/$1"

if [ -f "$target" ]; then
    awk '/^# ┌/,/^# End Help/' "$target" | sed 's/^# //'
else
    echo "Tool '$1' not found in $TOOL_ROOT/bash."
fi
