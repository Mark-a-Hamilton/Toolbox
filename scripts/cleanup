#!/bin/bash
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Version        : 2026.02.13-01                        â”‚
# â”‚ Author         : Mark Hamilton â”‚ Co-Pilot AI assisted â”‚
# â”‚ Script Purpose : System maintenance & hygiene tool    â”‚
# â”‚ Package        : toolbox                              â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# Usage:
#   cleanup [--dry-run] [--log] [--hashmap]
#
# Examples:
#   cleanup
#   cleanup --dry-run
#   cleanup --log
#   cleanup --hashmap
#
# Description:
#   Performs general system maintenance by removing temporary files,
#   clearing package caches, and cleaning unused dependencies.
#   Designed to work across Debian-based systems (Ubuntu, Debian, Kali, etc.).
#
# Output Files:
#   /var/log/cleanup.log           (when --log is used)
#   .hashmap/cleanup.hash          (when --hashmap is used)
#   .hashmap/cleanup.timestamp     (when --hashmap is used)
#
# End Help

set -e

LOG=false
DRY_RUN=false
HASHMAP=false

while [[ "$#" -gt 0 ]]; do
    case "$1" in
        --dry-run) DRY_RUN=true ;;
        --log) LOG=true ;;
        --hashmap) HASHMAP=true ;;
        --help)
            echo "Usage: cleanup [--dry-run] [--log] [--hashmap]"
            exit 0 ;;
        *) echo "Unknown option: $1"; exit 1 ;;
    esac
    shift
done

steps=(
    "apt autoremove -y"
    "apt clean"
    "rm -rf /var/cache/apt/*"
    "rm -rf /tmp/*"
)

echo "ğŸ§¹ Starting system cleanup..."
for step in "${steps[@]}"; do
    if $DRY_RUN; then
        echo "[DRY-RUN] Would execute: $step"
    else
        echo "âœ… Executing: $step"
        eval "$step"
    fi
done

if $LOG && ! $DRY_RUN; then
    LOGFILE="/var/log/cleanup.log"
    echo "ğŸ“ Logging to $LOGFILE"
    {
        echo "=== cleanup ==="
        date
        for step in "${steps[@]}"; do echo "$step"; done
        echo "===================="
    } >> "$LOGFILE"
fi

if $HASHMAP; then
    mkdir -p .hashmap
    sha256sum "$0" > .hashmap/cleanup.hash
    date > .hashmap/cleanup.timestamp
    echo "ğŸ” Hashmap written to .hashmap/cleanup.hash and .hashmap/cleanup.timestamp"
fi

echo "ğŸ‰ Cleanup complete."
